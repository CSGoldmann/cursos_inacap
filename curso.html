<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Curso en detalle</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .course-hero img { width: 100%; height: 100%; object-fit: cover; }
        .instructor-avatar { width: 64px; height: 64px; border-radius: 16px; object-fit: cover; }
        #curso-tags .badge { letter-spacing: 0.04em; border-radius: 999px; }
        #curso-detalle-container { max-width: 1140px; }
    </style>
</head>
<body class="bg-light">
    <div class="d-flex vh-100">
        <div id="sidebar"></div>
        <div class="flex-grow-1 d-flex flex-column">
            <div id="header"></div>
            <main class="flex-grow-1 p-4 p-lg-5 overflow-auto">
                <div class="container" id="curso-detalle-container">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="course-hero mb-4 position-relative">
                                <div class="ratio ratio-16x9 rounded overflow-hidden shadow-sm">
                                    <img id="curso-imagen" src="Pictures/default-course.jpg" alt="Imagen del curso">
                                </div>
                            </div>
                            <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
                                <div>
                                    <h1 id="curso-titulo" class="h3 fw-bold mb-1">Cargando curso...</h1>
                                    <p id="curso-metadata" class="text-muted mb-0 small">
                                        Profesor: — • <span class="text-warning">★★★★★</span> • 0 valoraciones
                                    </p>
                                </div>
                                <div class="d-flex gap-2">
                                    <button id="btn-cta-primario" class="btn btn-primary px-4">Iniciar curso</button>
                                    <button id="btn-cta-secundario" class="btn btn-outline-light text-white border px-4">Ver temario</button>
                                </div>
                            </div>

                            <section class="mt-4">
                                <h5>Descripción</h5>
                                <p id="curso-descripcion" class="text-secondary">
                                    Explora la descripción completa del curso y cómo se alinea con tus objetivos profesionales.
                                </p>
                                <div id="curso-tags" class="d-flex flex-wrap gap-2 mt-3 small text-uppercase text-secondary"></div>
                            </section>

                            <section class="mt-5">
                                <h5>Contenido del curso</h5>
                                <div class="accordion" id="curriculum">
                                    <div class="text-center py-4 text-muted small">
                                        Cargando el programa académico...
                                    </div>
                                </div>
                            </section>

                            <section class="mt-5">
                                <h5>Sobre el instructor</h5>
                                <div class="card p-3 p-md-4 mb-5">
                                    <div class="d-flex align-items-start gap-3">
                                        <img id="instructor-avatar" src="Pictures/profile-icon.png" alt="Instructor" class="instructor-avatar border shadow-sm">
                                        <div>
                                            <div id="instructor-nombre" class="fw-semibold">—</div>
                                            <div id="instructor-bio" class="small text-secondary">
                                                Conoce al especialista responsable de guiarte durante el curso.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <aside class="col-lg-4">
                            <div class="card p-3 p-md-4 mb-3">
                                <div class="fs-5 fw-semibold">Acceso al curso</div>
                                <p id="curso-resumen-sidebar" class="small text-secondary mb-3">
                                    Comienza ahora y desbloquea todas las lecciones, evaluaciones y recursos descargables.
                                </p>
                                <button id="btn-empezar-ahora" class="btn btn-primary w-100 mb-2">Empezar ahora</button>
                                <button id="btn-guardar-favorito" class="btn btn-outline-secondary w-100">Guardar en favoritos</button>
                            </div>
                            <div class="card p-3 p-md-4">
                                <div class="small text-secondary text-uppercase fw-semibold mb-2">Detalles</div>
                                <ul class="list-unstyled small mb-0" id="curso-detalles-list">
                                    <li>Duración: —</li>
                                    <li>Nivel: —</li>
                                    <li>Idioma: —</li>
                                    <li>Estudiantes inscritos: —</li>
                                </ul>
                            </div>
                        </aside>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="scripts/include.js"></script>
    <script src="scripts/api.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/inscripciones.js"></script>
    <script src="scripts/curso-detalle.js"></script>
    <script src="scripts/notificaciones-api.js"></script>
    <script src="scripts/app.js"></script>
    <script>
    // Funcionalidad del botón "Empezar ahora"
    document.addEventListener('DOMContentLoaded', async () => {
      const btnEmpezar = document.getElementById('btn-empezar-ahora');
      if (btnEmpezar) {
        // Verificar autenticación
        if (window.auth) {
          await window.auth.init();
          
          if (!window.auth.estaAutenticado()) {
            btnEmpezar.textContent = 'Iniciar sesión para comenzar';
            btnEmpezar.onclick = () => window.location.href = 'login.html';
            return;
          }

          // Obtener ID del curso
          const params = new URLSearchParams(window.location.search);
          const cursoId = params.get('id');
          
          if (!cursoId || cursoId.startsWith('static-')) {
            btnEmpezar.disabled = true;
            btnEmpezar.textContent = 'Curso de demostración';
            return;
          }

          // Verificar si ya está inscrito
          const estaInscrito = await window.inscripcionesAPI.estaInscrito(cursoId);
          
          if (estaInscrito) {
            btnEmpezar.textContent = 'Continuar curso';
            btnEmpezar.className = 'btn btn-success w-100 mb-2';
            btnEmpezar.onclick = () => {
              window.location.href = `curso-vista.html?id=${cursoId}`;
            };
          } else {
            btnEmpezar.onclick = async () => {
              btnEmpezar.disabled = true;
              btnEmpezar.textContent = 'Inscribiendo...';
              
              const resultado = await window.inscripcionesAPI.inscribirse(cursoId);
              
              if (resultado.success) {
                btnEmpezar.textContent = 'Continuar curso';
                btnEmpezar.className = 'btn btn-success w-100 mb-2';
                alert('¡Te has inscrito exitosamente al curso!');
                // Recargar notificaciones si existe el API
                if (window.notificacionesAPI) {
                  await window.notificacionesAPI.cargarNotificaciones();
                }
                // Redirigir a la vista del curso
                setTimeout(() => {
                  window.location.href = `curso-vista.html?id=${cursoId}`;
                }, 1000);
              } else {
                alert('Error: ' + (resultado.error || 'No se pudo inscribir'));
                btnEmpezar.disabled = false;
                btnEmpezar.textContent = 'Empezar ahora';
              }
            };
          }
        }
      }
    });
    </script>
</body>
</html>
